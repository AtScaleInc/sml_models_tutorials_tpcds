unique_name: store_returns
object_type: dataset
label: store_returns
connection_id: Connection - TPCDS
sql: "\"sr_addr_sk\", \"sr_cdemo_sk\", \"sr_customer_sk\", \"sr_hdemo_sk\", \"sr_item_sk\", \"sr_return_time_sk\", \"sr_returned_date_sk\", \"sr_store_sk\",
            case when (\"sr_returned_date_sk\" - \"ss_sold_date_sk\" <= 30) then '<= 30 days'
              when (\"sr_returned_date_sk\" - \"ss_sold_date_sk\" > 30) and  
                (\"sr_returned_date_sk\" - \"ss_sold_date_sk\" <= 60) then '31-60 days'
              when (\"sr_returned_date_sk\" - \"ss_sold_date_sk\" > 60) and
                (\"sr_returned_date_sk\" - \"ss_sold_date_sk\" <= 90) then '61-90 days'
              when (\"sr_returned_date_sk\" - \"ss_sold_date_sk\" > 90) and 
                (\"sr_returned_date_sk\" - \"ss_sold_date_sk\" <= 120) then '91-120 days'
              else '> 120 days' end as \"returns_time_tier\",
            1 as \"returns_count\"
          FROM \"atscale_tutorial_data\".\"tpcds\".\"store_returns\" sr
          INNER JOIN \"atscale_tutorial_data\".\"tpcds\".\"store_sales\" ss
            ON ss.\"ss_ticket_number\" = sr.\"sr_ticket_number\"
            AND ss.\"ss_item_sk\" = sr.\"sr_item_sk\"
            AND ss.\"ss_customer_sk\" = sr.\"sr_customer_sk\""
dialects:
  - dialect: DatabricksSQL
    sql: "SELECT sr_addr_sk, sr_cdemo_sk, sr_customer_sk, sr_hdemo_sk, sr_item_sk, sr_return_time_sk, sr_returned_date_sk, sr_store_sk,
    case when (sr_returned_date_sk - ss_sold_date_sk <= 30) then '<= 30 days'
      when (sr_returned_date_sk - ss_sold_date_sk > 30) and  
          (sr_returned_date_sk - ss_sold_date_sk <= 60) then '31-60 days'
      when (sr_returned_date_sk - ss_sold_date_sk > 60) and
          (sr_returned_date_sk - ss_sold_date_sk <= 90) then '61-90 days'
      when (sr_returned_date_sk - ss_sold_date_sk > 90) and 
          (sr_returned_date_sk - ss_sold_date_sk <= 120) then '91-120 days'
      else '> 120 days' end as returns_time_tier,
    1 as returns_count 
    FROM atscale_tutorial_data.tpcds.store_returns sr
    INNER JOIN atscale_tutorial_data.tpcds.store_sales ss
    ON ss.ss_ticket_number = sr.sr_ticket_number
    AND ss.ss_item_sk = sr.sr_item_sk
    AND ss.ss_customer_sk = sr.sr_customer_sk"
- dialect: BigQuery
    sql: "SELECT sr_addr_sk, sr_cdemo_sk, sr_customer_sk, sr_hdemo_sk, sr_item_sk, sr_return_time_sk, sr_returned_date_sk, sr_store_sk,
    case when (sr_returned_date_sk - ss_sold_date_sk <= 30) then '<= 30 days'
      when (sr_returned_date_sk - ss_sold_date_sk > 30) and  
          (sr_returned_date_sk - ss_sold_date_sk <= 60) then '31-60 days'
      when (sr_returned_date_sk - ss_sold_date_sk > 60) and
          (sr_returned_date_sk - ss_sold_date_sk <= 90) then '61-90 days'
      when (sr_returned_date_sk - ss_sold_date_sk > 90) and 
          (sr_returned_date_sk - ss_sold_date_sk <= 120) then '91-120 days'
      else '> 120 days' end as returns_time_tier,
    1 as returns_count 
    FROM atscale-tutorial-data.tpcds.store_returns sr
    INNER JOIN atscale-tutorial-data.tpcds.store_sales ss
    ON ss.ss_ticket_number = sr.sr_ticket_number
    AND ss.ss_item_sk = sr.sr_item_sk
    AND ss.ss_customer_sk = sr.sr_customer_sk"

columns:
  - name: returns_count
    data_type: long
  - name: returns_time_tier
    data_type: string
  - name: sr_addr_sk
    data_type: long
  - name: sr_cdemo_sk
    data_type: long
  - name: sr_customer_sk
    data_type: long
  - name: sr_hdemo_sk
    data_type: long
  - name: sr_item_sk
    data_type: long
  - name: sr_return_time_sk
    data_type: long
  - name: sr_returned_date_sk
    data_type: long
  - name: sr_store_sk
    data_type: long
